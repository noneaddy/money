# Mobile Security Framework (MobSF) Configuration

***

## Requirements

### Static Analysis
* Python 3.6+ - [Python 3.6 Download](https://www.python.org/downloads/)
* Oracle JDK 1.7 or above - [Java JDK Download](http://www.oracle.com/technetwork/java/javase/downloads/)
* Mac OS Users must install Command-line tools - [How to Install Commandline Tools in Mac](http://osxdaily.com/2014/02/12/install-command-line-tools-mac-os-x/)
* iOS IPA Analysis works only on Mac and Linux (so in Docker image too).
* Windows App Static analysis requires a Windows Host or Windows VM for Mac and Linux. For Windows App Static Analysis, Read [Windows App Static Analysis](https://github.com/MobSF/Mobile-Security-Framework-MobSF/blob/master/install/windows/readme.md)
 
**NOTE:**
* On Linux and Mac, install Oracle Java 1.7 or above and **make it the default** one.
* On Linux, make sure you have 32 bit execution support enabled.

### Dynamic Analysis
* If you are going to use MobSF x86 Android VM, it requires Oracle VirtualBox - [VirtualBox Download](https://www.virtualbox.org/wiki/Downloads).
   * Download MobSF Android x86 4.4.2 VM (v0.3) ova file: [https://goo.gl/QxgHZa](https://goo.gl/QxgHZa)
* If you are going to use MobSF Android AVD (ARM Emulator), It requires [Android Studio](https://developer.android.com/studio/index.html) and a configured AVD. 
   * Download MobSF Android arm Emulator 4.1.2 (v1.0) file [https://goo.gl/LRrGs3](https://goo.gl/LRrGs3)
* Hardware Requirements: Min 4GB RAM, 5GB HDD/SSD and Virtualization Support for running MobSF VM and Intel HAXM if you are running MobSF ARM Emulator.

## Installation

### Run MobSF Docker image

> Lazy to setup Static Analysis?
Use the latest MobSF docker image. (Dynamic analysis mostly need you to configure MobSF in host OS than inside a container.) 

```
docker pull opensecurity/mobile-security-framework-mobsf
docker run -it -p 8000:8000 opensecurity/mobile-security-framework-mobsf:latest
```

### Configuring Static Analyzer

**Tested on Windows (7, 8, 8.1, 10), Kali (2016.2), Ubuntu (14.04, 16.04) , OSX (Mavericks, Yosemite, El Capitan), OS (Sierra, High Sierra)**

> If you need Dynamic Analysis do not setup MobSF inside a VM or use Docker, set it up in your Host OS.

```
git clone https://github.com/MobSF/Mobile-Security-Framework-MobSF.git
cd Mobile-Security-Framework-MobSF
./setup.sh # For Linux and Mac
setup.bat # For Windows
```

##### PDF Report Generation

* You need to install `wkhtmltopdf` binary separately for generating PDF reports.
* Check [wkhtmltopdf downloads](http://wkhtmltopdf.org/downloads.html) and 
[Installing wkhtmltopdf wiki](https://github.com/JazzCore/python-pdfkit/wiki/Installing-wkhtmltopdf) for more information.
* In Windows, you need to add the folder that contains `wkhtmltopdf` binary to environment variable PATH.

### Running MobSF

* For Linux and Mac: `./run.sh` 
* For Windows: `run.bat` 

If everything goes right, you will get an output like the one below.

![Mobile Security Framework (MobSF) Running](https://cloud.githubusercontent.com/assets/4301109/21996120/aca05004-dc4e-11e6-849f-1ed73ea8a34c.png)

You can navigate to `http://localhost:8000/` to access the MobSF Web interface.

If you need to run on a specific port number try  `python manage.py runserver PORT_NO`.
To expose MobSF to a particular IP, you can try `python manage.py runserver IP:PORT_NO`. This needs to be executed from within the virtualenv.
***

### Configuring Dynamic Analyzer

MobSF Dynamic Analysis currently supports Android and can be done in four ways.

1. [Dynamic Analysis with MobSF Android 4.4.2 x86 VirtualBox VM - **default** (Fast, not all Apps work)](https://github.com/MobSF/Mobile-Security-Framework-MobSF/wiki/11.-Configuring-Dynamic-Analyzer-with-MobSF-Android-4.4.2-x86-VirtualBox-VM)
2. [Dynamic Analysis with MobSF Android 4.1.2 arm Emulator - (Slow, Most Apps work)](https://github.com/MobSF/Mobile-Security-Framework-MobSF/wiki/12.-Configuring-Dynamic-Analyzer-with-with-MobSF-Android-4.1.2-arm-Emulator) (**Not Supported Anymore**)
3. [Dynamic Analysis using a Rooted Android 4.03 - 4.4 Device (Very Fast, All Apps work)](https://github.com/MobSF/Mobile-Security-Framework-MobSF/wiki/13.-Configuring-Dynamic-Analyzer-with-Rooted-Android-4.03---4.4-Device)
4. [Dynamic Analysis using a Rooted Android 4.03 - 4.4 VM (not tested)](https://github.com/MobSF/Mobile-Security-Framework-MobSF/wiki/14.-Configuring-Dynamic-Analyzer-with-Rooted-Android-4.03---4.4-VM)

***

## Updating MobSF

If you are updating MobSF, In most cases you might have to perform database migrations or you will see errors such as
```
[ERROR] Saving to DB (E:\Mobile-Security-Framework-MobSF\StaticAnalyzer\views\android\db_interaction.py, LINE 236 "static_db.save()"): table StaticAnalyzer_staticanalyzerandroid has no column named 
```

Run the below command to migrate your db
```
python3 manage.py makemigrations
python3 manage.py migrate
```

If the above changes didn't work, you might have to run `clean.sh`(present in `scripts`) in Mac/Linux. After that run the above commands.

NOTE: This will remove the previously saved MobSF scan results.

***
## Disabled Components

Some components are disabled by default as they are experimental 
### APKiD 

APKiD is disabled by default. Before enabling you will have to install VirusTotal yara-python.
_Please note_: _APKiD is enabled by default in Docker image_
```
pip install wheel
pip wheel --wheel-dir=/tmp/yara-python --build-option="build" --build-option="--enable-dex" git+https://github.com/VirusTotal/yara-python.git@v3.10.0
pip install --no-index --find-links=/tmp/yara-python yara-python
pip install apkid
```
Enable APKiD in `settings.py` by setting `APKID_ENABLED` to `True`.

### VirusTotal

VirusTotal Scan is disabled by default. You need to add your VirusTotal API Key before enabling it. If you don't have an API Key, Register at https://www.virustotal.com/#/join-us and access your API Key from https://www.virustotal.com/en/user/[username]/apikey/. In `settings.py`, add your API Key to `VT_API_KEY` and set `VT_ENABLED` to `True`

## Mass Static Analysis

MobSF supports mass static analysis: 
[Run Mass Static Analysis with MobSF](https://github.com/MobSF/Mobile-Security-Framework-MobSF/wiki/4.-Mass-Static-Analysis)

## Using Postgres DB instead of SQLite:

[How to Configure Postgres DB](https://github.com/MobSF/Mobile-Security-Framework-MobSF/wiki/8.-Use-Postgres-Database-Instead-of-Sqlite3)

## Home Directory Support

If you want all user uploads, downloads and user configurations to be created in home directory, enable home directory support: [Home Directory Support](https://github.com/MobSF/Mobile-Security-Framework-MobSF/wiki/5.-Home-Directory-Support)

## Docker Image for MobSF Static Analysis

[Dockerfile and Docker Image](https://github.com/MobSF/Mobile-Security-Framework-MobSF/wiki/7.-Docker-Container-for-MobSF-Static-Analysis)

## REST API

MobSF REST API Docs: [API Docs](https://github.com/MobSF/Mobile-Security-Framework-MobSF/wiki/3.-REST-API-Documentation)

## CI/CD

[MobSF CI/CD Pipeline](https://github.com/MobSF/Mobile-Security-Framework-MobSF/wiki/10.-MobSF-CI-CD)

## Running Tests

You can run all the unit tests with `python manage.py test`